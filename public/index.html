<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
 
        <title>Directme Chat Connect (Private Room)</title>
        <meta name="description" content="Directme Chat Connect (Private Room)" />
        <link rel="stylesheet" href="css/style.css" />
        <link rel="shortcut icon" type="image/ico" href="/favicon.ico" />
        <link rel="stylesheet" href="css/main.css" />
        <script src="https://kit.fontawesome.com/c939d0e917.js"></script>
    </head>

    <body>
        <div class="header">
            <div class="logo">
                <div id="clock" class="header__back">
                    <span id="seconds">00</span>:<span id="tens">00</span>
                </div>
                <h3>Directme Chat Connect (Private Room)</h3>
            </div>
        </div>
        <div id="main" class="main">  
            <div class="main__left">
              <div class="videos__group">
                <div id="video-grid">
                    <div id="videos">
                        <div id="videoGrid" class="grid-container">
                            <div id="localVideo-container">
                                <video autoplay playsinline muted></video>
                            </div>
                        </div>
                    </div>
                </div>
              </div>
              <div class="options">
                <div class="options__left">
                    <!--
                  <div id="stopVideo" class="options__button">
                    <i class="fa fa-video-camera"></i>
                  </div>
                  <div id="muteButton" class="options__button">
                    <i class="fa fa-microphone"></i>
                  </div>
                  <div id="showChat" class="options__button">
                    <i class="fa fa-comment"></i>
                  </div>
                    -->
                </div>
                <div class="options__right">
                  <div id="exit" class="options__button">
                    <i class="fas fa-sync-alt"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="main__right">
              <div id="main__chat_window" class="main__chat_window">
                  <div id="chatbox" class="messages">
                     
                  </div>
              </div>
              <div class="main__message_container">
                <input id="chat_message" type="text" autocomplete="off" placeholder="Nachricht eingeben..." autofocus>
                <div id="send" class="options__button">
                  <i class="fa fa-plus" aria-hidden="true"></i>
                </div>
              </div>
            </div>
          </div>
          <div id="loginForm" class="login__form active">
            <p>
              Directme Chat Connect ist eine speziell Entwickelte Video Plattform. Wir verbinden dich gleich mit einem anderen User. Ihr könnt euch sehen, aber nicht hören.<br>
              Ihr könnt euch schreiben und machen, was ihr wollt. Dieser Chatraum ist 100% Privat. <br>
              Du musst mindestens 18 Jahre alt sein.<br>
              <strong>Wir raten dir dringend von einem Smartphone ab, da das Schreiben auf diesen Geräten sehr umständlich ist und den Spaß verringert. Wir empfehlen ein Notebook oder ein Tablet mit angeschlossener Tastatur</strong><br><br>
              <small>Bitte achte darauf, dass nichts auf deine Identität schließen lässt. 
                <br>Gebe niemals private Details heraus!<br>
                Keinerlei Daten werden gespeichert!<br>Keine Videos werden aufgenommen!</small>
            </p>
            <label for="roomId">Raum-Passwort:</label>
            <div class="login__inputs">
              <input id="roomId" type="text" />
              <button class="options__button" id="joinBtn"><i class="fa-solid fa-check"></i></button>
            </div>
          </div>

        <p id="notification"></p>

        <script src="/socket.io/socket.io.js"></script>
        <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
        <script src="js/webrtc.js"></script>
        <script src="js/main.js"></script>
        <script>
          $(document).ready(function () {

          $("#send").click(function () {
              var clientmsg = $("#chat_message").val();
              $.post("post.php", { text: clientmsg });
              $("#chat_message").val("");
              return false;
          });

          document.getElementById("chat_message").addEventListener("keypress", function(event) {
              if (event.key === "Enter") {
                  event.preventDefault();
                  document.getElementById("send").click();
              }
          });

          function loadLog() {
              var oldscrollHeight = $("#main__chat_window")[0].scrollHeight - 20; //Scroll height before the request

              $.ajax({
                  url: "log.html",
                  cache: false,
                  success: function (html) {
                      $("#chatbox").html(html); //Insert chat log into the #chatbox div

                      //Auto-scroll           
                      var newscrollHeight = $("#main__chat_window")[0].scrollHeight - 20; //Scroll height after the request
                      if(newscrollHeight > oldscrollHeight){
                          $("#main__chat_window").animate({ scrollTop: newscrollHeight }, 'normal'); //Autoscroll to bottom of div
                      }   
                  }
              });
          }

          setInterval (loadLog, 1000);
          });
        </script>
    </body>
</html>
